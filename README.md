üìò Bracket Manager (Exit-Only + Crypto Momentum)

Node.js manager for Robinhood positions with:
	‚Ä¢	‚úÖ Exit management (take-profit + stop-loss, optional trailing stops)
	‚Ä¢	‚úÖ Dry-run mode (real quotes/positions, no order placement)
	‚Ä¢	‚úÖ MTM snapshots + realized P/L logging (mtm.csv, trades.csv)
	‚Ä¢	‚úÖ Dashboard (live cards + rolling P/L sparklines)
	‚Ä¢	‚úÖ Trades page (historical table, CSV download, reset button)
	‚Ä¢	‚úÖ Runtime overrides (absolute / % based) via API or overrides.json
	‚Ä¢	‚úÖ End-of-day (EOD) closeout option
	‚Ä¢	‚úÖ Reset trade history via API
	‚Ä¢	‚úÖ Interactive API docs (Swagger UI)
	‚Ä¢	‚úÖ Crypto momentum entry strategy: auto-buy if price > X% in 1h, then bracket exits
	‚Ä¢	‚úÖ Max concurrent crypto positions (configurable in .env)
	‚Ä¢	‚úÖ Backtest script for momentum strategy

‚∏ª

üõ† Requirements
	‚Ä¢	Node.js v18+ (ESM support, top-level await)
	‚Ä¢	A Robinhood account (username + password in .env)
	‚Ä¢	Packages (see package.json):
	‚Ä¢	express, dotenv, pino, robinhood-node

‚∏ª

‚öôÔ∏è Setup

# clone repo
cd rh-bracket

# install deps
npm install

.env

# Robinhood
RH_USERNAME=your_robinhood_username
RH_PASSWORD=your_robinhood_password

# Polling & behavior
POLL_INTERVAL_MS=30000
DRY_RUN=true
DRY_RUN_SLIPPAGE_BPS=5
DRY_RUN_FEE_PER_TRADE=0.00

# Market hours gating
MARKET_HOURS_ONLY=true

# EOD closeout
EOD_CLOSE_ENABLED=true
EOD_CUTOFF_MINUTES=5
EOD_CLOSE_PARTIAL_PCT=100

# Crypto concurrency
MAX_CONCURRENT_CRYPTO=3

# API server
API_HOST=127.0.0.1
API_PORT=7070


‚∏ª

config/config.json

{
  "tickers": [
    { "symbol": "AAPL", "qty": 5, "target": 190.0, "stop": 170.0, "trailPct": 2.0, "timeInForce": "gfd" }
  ],
  "cryptoMomentum": [
    {
      "pair": "BTC-USD",
      "thresholdPct": 5.0,          // buy if +5% in 1h
      "lookbackMinutes": 60,
      "pollMs": 30000,
      "order": { "sizeUSD": 100.0, "timeInForce": "gtc", "type": "market" },
      "postBuyBracket": { "targetPct": 4.0, "stopPct": 2.0, "trailPct": 0 },
      "cooldownMinutes": 180
    }
  ]
}

config/overrides.json

Runtime overrides (hot-reloaded by API/UI):

{
  "AAPL": { "mode": "absolute", "target": 192.5, "stop": 178.2 },
  "BTC-USD": { "mode": "percent", "targetPct": 4, "stopPct": 2 }
}


‚∏ª

‚ñ∂Ô∏è Running

Start the manager:

npm start

Logs show session config and login status.

‚∏ª

üåê Dashboard & UI
	‚Ä¢	Dashboard ‚Üí http://127.0.0.1:7070/dashboard
(per-symbol P/L cards, rolling sparkline, portfolio updates)
	‚Ä¢	Trades ‚Üí http://127.0.0.1:7070/trades
(historical exits table, CSV download, reset button)
	‚Ä¢	API Docs ‚Üí http://127.0.0.1:7070/openapi.html
(Swagger UI for all endpoints)

‚∏ª

üìä Data Outputs

All written under var/:
	‚Ä¢	trade.log ‚Äî structured logs (pino JSON)
	‚Ä¢	trades.csv ‚Äî realized exits with cumulative P/L
	‚Ä¢	mtm.csv ‚Äî MTM snapshots each tick (unrealized P/L)
	‚Ä¢	backtest_trades.csv ‚Äî generated by backtester
	‚Ä¢	backtest_summary.txt ‚Äî stats from backtester

‚∏ª

üì° API Summary
	‚Ä¢	GET /api/mtm ‚Üí latest MTM + realized P/L
	‚Ä¢	GET /api/mtm_series?symbol=SYM&limit=200 ‚Üí rolling series (sparkline)
	‚Ä¢	GET /api/trades?limit=200 ‚Üí historical trades
	‚Ä¢	POST /overrides/:symbol/absolute ‚Üí set absolute target/stop
	‚Ä¢	POST /overrides/:symbol/percent ‚Üí set % target/stop
	‚Ä¢	POST /control/dry-run ‚Üí toggle dry-run ({ "dryRun": true })
	‚Ä¢	POST /api/reset ‚Üí reset trade & MTM history

‚∏ª

üìà Backtesting Momentum

A script is provided in scripts/backtestMomentum.mjs.

Input format

CSV with at least ts,price columns:

ts,price
2025-01-01T00:00:00Z,42000
2025-01-01T00:01:00Z,42050
...

Run example

node scripts/backtestMomentum.mjs \
  --file=./data/BTC-USD.csv \
  --lookback=60 \
  --threshold=5 \
  --target=4 \
  --stop=2 \
  --trail=0 \
  --sizeUSD=100 \
  --cooldown=180 \
  --maxConcurrent=3

Output
	‚Ä¢	var/backtest_trades.csv ‚Üí list of simulated trades (entries, exits, PnL)
	‚Ä¢	var/backtest_summary.txt ‚Üí stats (trade count, winrate, total/avg PnL)

‚∏ª

üö¶ Notes
	‚Ä¢	In DRY_RUN=true:
	‚Ä¢	Real quotes/positions still fetched
	‚Ä¢	Orders simulated only
	‚Ä¢	In DRY_RUN=false:
	‚Ä¢	Real Robinhood orders are placed/canceled
	‚Ä¢	Crypto entry uses official Robinhood Crypto Trading API; ensure your requests are signed per RH docs for live trading.
	‚Ä¢	Max concurrent crypto positions controlled via .env.

‚∏ª

‚úÖ To run:

npm start

Then open the Dashboard at http://127.0.0.1:7070/dashboard.